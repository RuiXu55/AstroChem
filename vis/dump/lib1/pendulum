#include<stdio.h>
#include<stdlib.h>
#include<math.h>
#include <cvode/cvode.h>
#include <nvector/nvector_serial.h>
#include <cvode/cvode_dense.h>
#include <sundials/sundials_dense.h>
#include <sundials/sundials_types.h>
static int f(realtype t, N_Vector y, N_Vector ydot, void *f_data)
{
    realtype theta = NV_Ith_S(y,0);
    realtype omega = NV_Ith_S(y,1);
    realtype omegap = -sin(theta);
    NV_Ith_S(ydot,0) = omega;
    NV_Ith_S(ydot,1) = omegap;
return 0; }
int main(int argc, char** argv)
{
    int N = 200;
    realtype T0 = 0;
    realtype Tfinal = 10;
    realtype theta0 = atof(argv[1]);
    realtype reltol = 1e-6;
    realtype abstol = 1e-8;
    realtype t;
    int flag, k;
    N_Vector y = NULL;
    void* cvode_mem = NULL;
    /* Create serial vector of length NEQ for I.C. */
    y = N_VNew_Serial(2);
    NV_Ith_S(y,0) = theta0;
    NV_Ith_S(y,1) = 0;
    /* Set up solver */
    cvode_mem = CVodeCreate(CV_ADAMS, CV_FUNCTIONAL);
    if (cvode_mem == 0) {
        fprintf(stderr, "Error in CVodeMalloc: could not allocate\n");
return -1; }
    /* Call CVodeMalloc to initialize the integrator memory */
    flag = CVodeMalloc(cvode_mem, f, T0, y, CV_SS, reltol, &abstol);
    if (flag < 0) {
        fprintf(stderr, "Error in CVodeMalloc: %d\n", flag);
return -1; }
    /* In loop, call CVode, print results, and test for error. */
    for (k = 1; k < N; ++k) {
        realtype tout = k*Tfinal/N;
        if (CVode(cvode_mem, tout, y, &t, CV_NORMAL) < 0) {
            fprintf(stderr, "Error in CVode: %d\n", flag);
return -1; }
        printf("%g %.16e %.16e\n", t, NV_Ith_S(y,0), NV_Ith_S(y,1));
    }
ï¿¼
    N_VDestroy_Serial(y);
    CVodeFree(&cvode_mem);
return(0); }
/* Free y vector */
/* Free integrator memory */

